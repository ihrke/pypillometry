<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Processing monocular and binocular data &#8212; pypillometry  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=279e0f84" />
    <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pypillometry  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Processing monocular and binocular data</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="admonition note">
This file was created from the following Jupyter-notebook: <a href="https://github.com/ihrke/pypillometry/tree/master/eyes_and_variables.ipynb">eyes_and_variables.ipynb</a>
<br>
Interactive version:
<a href="https://mybinder.org/v2/gh/ihrke/pypillometry/master?filepath=eyes_and_variables.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a>
</div><section id="Processing-monocular-and-binocular-data">
<h1>Processing monocular and binocular data<a class="headerlink" href="#Processing-monocular-and-binocular-data" title="Link to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;..&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pypillometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
<p>Data in <code class="docutils literal notranslate"><span class="pre">pypillometry</span></code> can contain different <code class="docutils literal notranslate"><span class="pre">variables</span></code> from different <code class="docutils literal notranslate"><span class="pre">eyes</span></code>. The variables and eyes supported when importing raw data are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">left_x</span></code>, <code class="docutils literal notranslate"><span class="pre">right_x</span></code> (x-coordinate in screen coordinates from the eyetracker)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">left_y</span></code>, <code class="docutils literal notranslate"><span class="pre">right_y</span></code> (y-coordinate in screen coordinates from the eyetracker)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">left_pupil</span></code>, <code class="docutils literal notranslate"><span class="pre">right_pupil</span></code> (pupil size from left and right eye)</p></li>
</ul>
<p>Depending on which class is chosen (<code class="docutils literal notranslate"><span class="pre">PupilData</span></code>, <code class="docutils literal notranslate"><span class="pre">GazeData</span></code> or <code class="docutils literal notranslate"><span class="pre">EyeData</span></code>), some of these variables are required:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PupilData</span></code>: requires at least one of <code class="docutils literal notranslate"><span class="pre">left_pupil</span></code>, <code class="docutils literal notranslate"><span class="pre">right_pupil</span></code> (or both)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GazeData</span></code>: requires at least one of <code class="docutils literal notranslate"><span class="pre">(left_x,</span> <span class="pre">left_y)</span></code> and/or <code class="docutils literal notranslate"><span class="pre">(right_x,</span> <span class="pre">right_y)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EyeData</span></code>: requires <code class="docutils literal notranslate"><span class="pre">x</span></code>,<code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">pupil</span></code> from at least one eye</p></li>
</ul>
<p>For example, let’s simulate some basic data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">left_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">right_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">left_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">right_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">left_pupil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">right_pupil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># these are all ok</span>
<span class="n">dpupil</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">PupilData</span><span class="p">(</span><span class="n">left_pupil</span><span class="o">=</span><span class="n">left_pupil</span><span class="p">,</span> <span class="n">right_pupil</span><span class="o">=</span><span class="n">right_pupil</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
<span class="n">dgaze</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">GazeData</span><span class="p">(</span><span class="n">left_x</span><span class="o">=</span><span class="n">left_x</span><span class="p">,</span> <span class="n">left_y</span><span class="o">=</span><span class="n">left_y</span><span class="p">,</span> <span class="n">right_x</span><span class="o">=</span><span class="n">right_x</span><span class="p">,</span> <span class="n">right_y</span><span class="o">=</span><span class="n">right_y</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
<span class="n">deye</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">EyeData</span><span class="p">(</span><span class="n">left_x</span><span class="o">=</span><span class="n">left_x</span><span class="p">,</span> <span class="n">left_y</span><span class="o">=</span><span class="n">left_y</span><span class="p">,</span> <span class="n">left_pupil</span><span class="o">=</span><span class="n">left_pupil</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>

<span class="c1"># these are not ok</span>
<span class="c1">#pp.PupilData(left_x=left_x, time=time)</span>
<span class="c1">#pp.GazeData(left_x=left_x, time=time)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">EyeData</span><span class="p">(</span><span class="n">left_x</span><span class="o">=</span><span class="n">left_x</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[2], line 17</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span> deye <span style="color: rgb(98,98,98)">=</span> pp<span style="color: rgb(98,98,98)">.</span>EyeData(left_x<span style="color: rgb(98,98,98)">=</span>left_x, left_y<span style="color: rgb(98,98,98)">=</span>left_y, left_pupil<span style="color: rgb(98,98,98)">=</span>left_pupil, time<span style="color: rgb(98,98,98)">=</span>time)
<span class="ansi-green-intense-fg ansi-bold">     14</span> <span style="color: rgb(95,135,135)"># these are not ok</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span> <span style="color: rgb(95,135,135)">#pp.PupilData(left_x=left_x, time=time)</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span> <span style="color: rgb(95,135,135)">#pp.GazeData(left_x=left_x, time=time)</span>
<span class="ansi-green-fg">---&gt; 17</span> pp<span style="color: rgb(98,98,98)">.</span>EyeData(left_x<span style="color: rgb(98,98,98)">=</span>left_x, time<span style="color: rgb(98,98,98)">=</span>time)

File <span class="ansi-green-fg">~/Dropbox/work/projects/pupil/pypillometry/docs/../pypillometry/eyedata/eyedata.py:96</span>, in <span class="ansi-cyan-fg">EyeData.__init__</span><span class="ansi-blue-fg">(self, time, left_x, left_y, left_pupil, right_x, right_y, right_pupil, event_onsets, event_labels, sampling_rate, screen_resolution, physical_screen_size, screen_eye_distance, name, fill_time_discontinuities, keep_orig, notes, inplace, use_cache, cache_dir, max_memory_mb)</span>
<span class="ansi-green-intense-fg ansi-bold">     94</span> logger<span style="color: rgb(98,98,98)">.</span>debug(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">Creating EyeData object</span><span style="color: rgb(175,0,0)">&#34;</span>)
<span class="ansi-green-intense-fg ansi-bold">     95</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> (left_x <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span> <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> left_y <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>) <span class="ansi-bold" style="color: rgb(175,0,255)">and</span> (right_x <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span> <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> right_y <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>):
<span class="ansi-green-fg">---&gt; 96</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">ValueError</span>(<span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">At least one of the eye-traces must be provided (both x and y)</span><span style="color: rgb(175,0,0)">&#34;</span>)
<span class="ansi-green-intense-fg ansi-bold">     97</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>data<span style="color: rgb(98,98,98)">=</span>EyeDataDict(left_x<span style="color: rgb(98,98,98)">=</span>left_x, left_y<span style="color: rgb(98,98,98)">=</span>left_y, left_pupil<span style="color: rgb(98,98,98)">=</span>left_pupil,
<span class="ansi-green-intense-fg ansi-bold">     98</span>                         right_x<span style="color: rgb(98,98,98)">=</span>right_x, right_y<span style="color: rgb(98,98,98)">=</span>right_y, right_pupil<span style="color: rgb(98,98,98)">=</span>right_pupil)
<span class="ansi-green-intense-fg ansi-bold">    100</span> <span style="color: rgb(0,135,0)">self</span><span style="color: rgb(98,98,98)">.</span>_init_common(time, sampling_rate,
<span class="ansi-green-intense-fg ansi-bold">    101</span>                   event_onsets, event_labels,
<span class="ansi-green-intense-fg ansi-bold">    102</span>                   name, fill_time_discontinuities,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">    105</span>                   cache_dir<span style="color: rgb(98,98,98)">=</span>cache_dir,
<span class="ansi-green-intense-fg ansi-bold">    106</span>                   max_memory_mb<span style="color: rgb(98,98,98)">=</span>max_memory_mb)

<span class="ansi-red-fg">ValueError</span>: At least one of the eye-traces must be provided (both x and y)
</pre></div></div>
</div>
<p>Once the data is loaded, we can check which variables and eyes are available using the <code class="docutils literal notranslate"><span class="pre">.eyes</span></code> and <code class="docutils literal notranslate"><span class="pre">.variables</span></code> attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deye</span><span class="o">.</span><span class="n">eyes</span><span class="p">,</span> <span class="n">deye</span><span class="o">.</span><span class="n">variables</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
([&#39;left&#39;], [&#39;x&#39;, &#39;pupil&#39;, &#39;y&#39;])
</pre></div></div>
</div>
<p>Simply printing an object will also show what data sources are available and give a glimpse into the data structure:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deye</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EyeData(petokiga, 55.6KiB):
 n                   : 1000
 sampling_rate       : 1000.0
 data                : [&#39;left_x&#39;, &#39;left_y&#39;, &#39;left_pupil&#39;]
 nevents             : 0
 screen_limits       : not set
 physical_screen_size: not set
 screen_eye_distance : not set
 duration_minutes    : 0.016666666666666666
 start_min           : 0.0
 end_min             : 0.01665
 parameters          : {}
 glimpse             : EyeDataDict(vars=3,n=1000,shape=(1000,)):
  left_x (float64): -0.05614305080280796, -0.6414526083279584, -1.704862857943198, 1.4798705854852807, 0.8472706708383512...
  left_y (float64): -0.7499467879300401, 0.20023206315811148, 1.2681504964811687, -0.9232746614049664, -1.6396223281209275...
  left_pupil (float64): 0.28284068252769706, -0.4969359675178975, -1.7109730132713936, -1.024197014557436, -0.7792117291273035...

 eyes                : [&#39;left&#39;]
 nblinks             : {}
 blinks              : {&#39;left&#39;: None}
 params              : {}
 History:
 *
 └ fill_time_discontinuities()
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">get_example_data</span><span class="p">(</span><span class="s2">&quot;rlmw_002_short&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">eyes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
([&#39;pupil&#39;, &#39;y&#39;, &#39;x&#39;], [&#39;left&#39;, &#39;right&#39;])
</pre></div></div>
</div>
<p>Almost all of <code class="docutils literal notranslate"><span class="pre">pypillometry</span></code>’s functions have keyword arguments <code class="docutils literal notranslate"><span class="pre">eyes=</span></code> and <code class="docutils literal notranslate"><span class="pre">variables=</span></code> that specify which eyes/variables to operate on. By default, all of the variables and eyes are processed.</p>
<p>For example, we can run the <code class="docutils literal notranslate"><span class="pre">scale()</span></code> function that will re-scale the data to have mean=0 and standard devation 1. Here, we use the context manager <code class="docutils literal notranslate"><span class="pre">pp.loglevel(&quot;DEBUG&quot;)</span></code> to get output from <code class="docutils literal notranslate"><span class="pre">pypillometry</span></code> internals:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pp</span><span class="o">.</span><span class="n">loglevel</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">):</span>
    <span class="n">deye</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">eyes</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
<span class="ansi-green-fg">pp: 12:59:13</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">_get_eye_var</span>:<span class="ansi-cyan-fg">194</span> | <span class="ansi-blue-intense-fg ansi-bold">scale(): eyes=[&#39;left&#39;], vars=[&#39;pupil&#39;, &#39;y&#39;, &#39;x&#39;]</span>
<span class="ansi-green-fg">pp: 12:59:13</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">scale</span>:<span class="ansi-cyan-fg">820</span> | <span class="ansi-blue-intense-fg ansi-bold">Mean: {&#39;left&#39;: {&#39;pupil&#39;: 0.0017743030582778934, &#39;y&#39;: -0.02958842274723986, &#39;x&#39;: 0.025062813034298286}}</span>
<span class="ansi-green-fg">pp: 12:59:13</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">scale</span>:<span class="ansi-cyan-fg">821</span> | <span class="ansi-blue-intense-fg ansi-bold">SD: {&#39;left&#39;: {&#39;pupil&#39;: 0.9685169385611292, &#39;y&#39;: 1.012354831683368, &#39;x&#39;: 0.9977838504196321}}</span>
</pre></div></div>
</div>
<p>The output shows that all variables from the left eye have been processed.</p>
<section id="Which-functions-work-on-which-data?">
<h2>Which functions work on which data?<a class="headerlink" href="#Which-functions-work-on-which-data?" title="Link to this heading">¶</a></h2>
<p>Not all of <code class="docutils literal notranslate"><span class="pre">pypillometry</span></code>s functions can be applied to all variables. Functions that are specific to pupil data have the prefix <code class="docutils literal notranslate"><span class="pre">pupil_*</span></code> and functions that only work on gaze (x/y) data, have the prefix <code class="docutils literal notranslate"><span class="pre">gaze_</span></code>. The other functions will operate on all variables (which may or may not make sense, it is up to you to check!).</p>
<p>Functions that work only on pupillometric data are implemented in the <code class="docutils literal notranslate"><span class="pre">PupilData</span></code> class and are therefore not available when using <code class="docutils literal notranslate"><span class="pre">GazeData</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dpupil</span><span class="o">.</span><span class="n">pupil_blinks_detect</span><span class="p">()</span> <span class="c1"># works fine</span>
<span class="n">dgaze</span><span class="o">.</span><span class="n">pupil_blinks_detect</span><span class="p">()</span> <span class="c1"># fails</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[32], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> dpupil<span style="color: rgb(98,98,98)">.</span>pupil_blinks_detect() <span style="color: rgb(95,135,135)"># works fine</span>
<span class="ansi-green-fg">----&gt; 2</span> dgaze<span style="color: rgb(98,98,98)">.</span>pupil_blinks_detect()

<span class="ansi-red-fg">AttributeError</span>: &#39;GazeData&#39; object has no attribute &#39;pupil_blinks_detect&#39;
</pre></div></div>
</div>
<p>Functions that are implemented in <code class="docutils literal notranslate"><span class="pre">GenericEyeData</span></code> will work for both:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dpupil</span><span class="o">.</span><span class="n">scale</span><span class="p">()</span> <span class="c1"># works</span>
<span class="n">dgaze</span><span class="o">.</span><span class="n">scale</span><span class="p">()</span> <span class="c1"># works</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GazeData(gememoda, 103.9KiB):
 n                   : 1000
 sampling_rate       : 1000.0
 data                : [&#39;left_x&#39;, &#39;left_y&#39;, &#39;right_x&#39;, &#39;right_y&#39;, &#39;mean_y&#39;, &#39;mean_x&#39;]
 nevents             : 0
 screen_limits       : not set
 physical_screen_size: not set
 screen_eye_distance : not set
 duration_minutes    : 0.016666666666666666
 start_min           : 0.0
 end_min             : 0.01665
 parameters          : {scale: {...}}
 glimpse             : EyeDataDict(vars=6,n=1000,shape=(1000,)):
  left_x (float64): -0.0813862278918966, -0.6679957999740566, -1.7337679601147598, 1.458039004980029, 0.8240340404971094...
  left_y (float64): -0.711567073755129, 0.22701574459144955, 1.2819012451103702, -0.8827796447335403, -1.5903849667971501...
  right_x (float64): 0.9626973487677861, -0.17827876962019754, 0.1106137723940685, -0.9696903516215334, 0.6644680267943046...
  right_y (float64): 0.31340189774712973, 1.1308736355320714, -0.7814852910860114, -1.2597233647796173, -0.3645995245346349...
  mean_y (float64): -0.2900743012870026, 0.9746687313634781, 0.3671378610511327, -1.541330111846402, -1.4116343476312987...
  mean_x (float64): 0.6144940257680912, -0.5963646337735499, -1.1476480335279726, 0.353192240734368, 1.0459758453244563...

 History:
 *
 └ fill_time_discontinuities()
  └ merge_eyes()
   └ scale()
</pre></div></div>
</div>
</section>
<section id="Creating-new-variables-or-eyes">
<h2>Creating new variables or eyes<a class="headerlink" href="#Creating-new-variables-or-eyes" title="Link to this heading">¶</a></h2>
<p>In some cases, new variables or “eyes” can be created. For example, we might consider to reduce a binocular dataset to one where we average the timeseries from the two eyes. In that case, we can use function <code class="docutils literal notranslate"><span class="pre">merge_eyes()</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dpupil</span><span class="o">.</span><span class="n">merge_eyes</span><span class="p">(</span><span class="n">eyes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">],</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pupil&quot;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PupilData(debibiki, 56.3KiB):
 n               : 1000
 sampling_rate   : 1000.0
 eyes            : [&#39;mean&#39;, &#39;left&#39;, &#39;right&#39;]
 data            : [&#39;left_pupil&#39;, &#39;right_pupil&#39;, &#39;mean_pupil&#39;]
 nevents         : 0
 nblinks         : {}
 blinks          : {&#39;mean&#39;: None, &#39;left&#39;: None, &#39;right&#39;: None}
 duration_minutes: 0.016666666666666666
 start_min       : 0.0
 end_min         : 0.01665
 params          : {}
 glimpse         : EyeDataDict(vars=3,n=1000,shape=(1000,)):
  left_pupil (float64): 0.28284068252769706, -0.4969359675178975, -1.7109730132713936, -1.024197014557436, -0.7792117291273035...
  right_pupil (float64): 2.5061323051140176, 0.5500808555889285, -0.4194523189113897, 0.5384978966510412, -1.3899010906520874...
  mean_pupil (float64): 1.3944864938208574, 0.026572444035515508, -1.0652126660913916, -0.24284955895319738, -1.0845564098896956...

 History:
 *
 └ fill_time_discontinuities()
  └ merge_eyes(eyes=[&#39;left&#39;, &#39;right&#39;],variables=[&#39;pupil&#39;],method=mean)
</pre></div></div>
</div>
<p>We can see that a new “eye” with variable “pupil” called <code class="docutils literal notranslate"><span class="pre">mean_pupil</span></code> has been created. In this case, the original data <code class="docutils literal notranslate"><span class="pre">left_pupil</span></code> and <code class="docutils literal notranslate"><span class="pre">right_pupil</span></code> have been preserved (this can be changed by using <code class="docutils literal notranslate"><span class="pre">keep_eyes=False</span></code>).</p>
<p>In other cases, the package can create new variables. For example, the function <code class="docutils literal notranslate"><span class="pre">pupil_estimate_baseline()</span></code> will estimate tonic fluctuation in the pupil (see <a class="reference external" href="https://osf.io/preprints/psyarxiv/7ju4a_v2/">https://osf.io/preprints/psyarxiv/7ju4a_v2/</a>) and will create a new variable <code class="docutils literal notranslate"><span class="pre">&lt;eye&gt;_baseline</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">get_example_data</span><span class="p">(</span><span class="s2">&quot;rlmw_002_short&quot;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">pupil_estimate_baseline</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">variables</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;pupil&#39;, &#39;baseline&#39;, &#39;y&#39;, &#39;x&#39;]
</pre></div></div>
</div>
</section>
<section id="Debugging">
<h2>Debugging<a class="headerlink" href="#Debugging" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">If you want to be sure what steps <code class="docutils literal notranslate"><span class="pre">pupillometry</span></code> is taking, and which variables/eyes are being processed,</div>
<div class="line">you can use the <code class="docutils literal notranslate"><span class="pre">pp.loglevel()</span></code> context manager to temporarily increase the logging level (the result is a rather lengthy and detailed debug-output):</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pp</span><span class="o">.</span><span class="n">loglevel</span><span class="p">(</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">):</span>
    <span class="n">d</span><span class="o">.</span><span class="n">pupil_estimate_baseline</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">_get_eye_var</span>:<span class="ansi-cyan-fg">194</span> | <span class="ansi-blue-intense-fg ansi-bold">pupil_estimate_baseline(): eyes=[&#39;left&#39;, &#39;right&#39;], vars=[&#39;pupil&#39;, &#39;baseline&#39;, &#39;y&#39;, &#39;x&#39;]</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">pupil_estimate_baseline</span>:<span class="ansi-cyan-fg">413</span> | <span class="ansi-blue-intense-fg ansi-bold">Estimating baseline for eye left</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">198</span> | <span class="ansi-blue-intense-fg ansi-bold">Downsampling factor is 50</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">208</span> | <span class="ansi-blue-intense-fg ansi-bold">Downsampling done</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">214</span> | <span class="ansi-blue-intense-fg ansi-bold">Peak-detection done, 42 peaks detected</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">217</span> | <span class="ansi-blue-intense-fg ansi-bold">B-spline matrix built, dims=(410, 46)</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">228</span> | <span class="ansi-blue-intense-fg ansi-bold">Compiling Stan model: /home/mmi041/Dropbox/work/projects/pupil/pypillometry/docs/../pypillometry/stan/baseline_model_asym_laplac.stan</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">250</span> | <span class="ansi-blue-intense-fg ansi-bold">Optimizing Stan model</span>
13:12:00 - cmdstanpy - INFO - Chain [1] start processing
13:12:00 - cmdstanpy - INFO - Chain [1] done processing
13:12:00 - cmdstanpy - WARNING - The default behavior of CmdStanVB.stan_variable() will change in a future release to return the variational sample, rather than the mean.
To maintain the current behavior, pass the argument mean=True
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">259</span> | <span class="ansi-blue-intense-fg ansi-bold">Estimating PRF model (NNLS)</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">270</span> | <span class="ansi-blue-intense-fg ansi-bold">2nd Peak-detection done, 32 peaks detected</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">274</span> | <span class="ansi-blue-intense-fg ansi-bold">2nd B-spline matrix built, dims=(410, 36)</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">291</span> | <span class="ansi-blue-intense-fg ansi-bold">Optimizing 2nd Stan model</span>
13:12:00 - cmdstanpy - INFO - Chain [1] start processing
13:12:00 - cmdstanpy - INFO - Chain [1] done processing
13:12:00 - cmdstanpy - WARNING - The default behavior of CmdStanVB.stan_variable() will change in a future release to return the variational sample, rather than the mean.
To maintain the current behavior, pass the argument mean=True
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">pupil_estimate_baseline</span>:<span class="ansi-cyan-fg">413</span> | <span class="ansi-blue-intense-fg ansi-bold">Estimating baseline for eye right</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">198</span> | <span class="ansi-blue-intense-fg ansi-bold">Downsampling factor is 50</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">208</span> | <span class="ansi-blue-intense-fg ansi-bold">Downsampling done</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">214</span> | <span class="ansi-blue-intense-fg ansi-bold">Peak-detection done, 42 peaks detected</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">217</span> | <span class="ansi-blue-intense-fg ansi-bold">B-spline matrix built, dims=(410, 46)</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">228</span> | <span class="ansi-blue-intense-fg ansi-bold">Compiling Stan model: /home/mmi041/Dropbox/work/projects/pupil/pypillometry/docs/../pypillometry/stan/baseline_model_asym_laplac.stan</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">250</span> | <span class="ansi-blue-intense-fg ansi-bold">Optimizing Stan model</span>
13:12:00 - cmdstanpy - INFO - Chain [1] start processing
13:12:00 - cmdstanpy - INFO - Chain [1] done processing
13:12:00 - cmdstanpy - WARNING - The default behavior of CmdStanVB.stan_variable() will change in a future release to return the variational sample, rather than the mean.
To maintain the current behavior, pass the argument mean=True
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">259</span> | <span class="ansi-blue-intense-fg ansi-bold">Estimating PRF model (NNLS)</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">270</span> | <span class="ansi-blue-intense-fg ansi-bold">2nd Peak-detection done, 35 peaks detected</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">274</span> | <span class="ansi-blue-intense-fg ansi-bold">2nd B-spline matrix built, dims=(410, 39)</span>
<span class="ansi-green-fg">pp: 13:12:00</span> | <span class="ansi-blue-intense-fg ansi-bold">DEBUG   </span> | <span class="ansi-cyan-fg">baseline_envelope_iter_bspline</span>:<span class="ansi-cyan-fg">291</span> | <span class="ansi-blue-intense-fg ansi-bold">Optimizing 2nd Stan model</span>
13:12:00 - cmdstanpy - INFO - Chain [1] start processing
13:12:00 - cmdstanpy - INFO - Chain [1] done processing
13:12:00 - cmdstanpy - WARNING - The default behavior of CmdStanVB.stan_variable() will change in a future release to return the variational sample, rather than the mean.
To maintain the current behavior, pass the argument mean=True
</pre></div></div>
</div>
</section>
</section>
<div class="admonition note">
This file was created from the following Jupyter-notebook: <a href="https://github.com/ihrke/pypillometry/tree/master/eyes_and_variables.ipynb">eyes_and_variables.ipynb</a>
<br>
Interactive version:
<a href="https://mybinder.org/v2/gh/ihrke/pypillometry/master?filepath=eyes_and_variables.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a>
</div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/pypillometry_logo_200x200.png" alt="Logo of pypillometry"/>
            </a></p>
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Processing monocular and binocular data</a><ul>
<li><a class="reference internal" href="#Which-functions-work-on-which-data?">Which functions work on which data?</a></li>
<li><a class="reference internal" href="#Creating-new-variables-or-eyes">Creating new variables or eyes</a></li>
<li><a class="reference internal" href="#Debugging">Debugging</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/eyes_and_variables.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pypillometry  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Processing monocular and binocular data</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2020-2025, Matthias Mittner.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>