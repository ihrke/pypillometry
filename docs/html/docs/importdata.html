
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Importing Data Example &#8212; pypillometry  documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Blink preprocessing" href="blinks.html" />
    <link rel="prev" title="Developers" href="dev.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="blinks.html" title="Blink preprocessing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dev.html" title="Developers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pypillometry  documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Importing-Data-Example">
<h1>Importing Data Example<a class="headerlink" href="#Importing-Data-Example" title="Permalink to this headline">¶</a></h1>
<p>In order to import data into <code class="docutils literal notranslate"><span class="pre">pypillometry</span></code>, we have to load the data from the source using other packages and then wrap it into <code class="docutils literal notranslate"><span class="pre">PupilData</span></code> objects.</p>
<p>Here we will show and example where we translate a file recorded in Eyelinks EDF-format to a file readable by <code class="docutils literal notranslate"><span class="pre">pandas.read_table()</span></code>.</p>
<p>First, we import the needed modules.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;..&quot;</span><span class="p">)</span> <span class="c1"># this is not needed if you have installed pypillometry</span>
<span class="kn">import</span> <span class="nn">pypillometry</span> <span class="k">as</span> <span class="nn">pp</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<p>In this example, we use data recorded with an Eyelink-eyetracker. These eyetrackers store the files in binary files with the extension <code class="docutils literal notranslate"><span class="pre">.edf</span></code>. Some information about this file-format is <a class="reference external" href="http://download.sr-support.com/dispdoc/page25.html">here</a>. We use a command-line utility released by Eyelink to convert this proprietory format into a more easily read <code class="docutils literal notranslate"><span class="pre">.asc</span></code> file that is a whitespace-separated plain-text format. The converter, <code class="docutils literal notranslate"><span class="pre">edf2asc</span></code> is a program that can be downloaded for different
platforms from the <a class="reference external" href="https://www.sr-research.com/support/">Eyelink support forum</a>. There is a GUI-based program for windows and command-line programs for linux and mac. Binaries of the command-line tools for linux and mac are included in <code class="docutils literal notranslate"><span class="pre">pypillometry</span></code> under <a class="reference external" href="https://github.com/ihrke/pypillometry/tree/master/external">this link</a>.</p>
<p>On linux, we would call these programs on an example edf-file twice as follows.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>../external/edf2asc-linux -y -s ../data/test.edf ../data/test_samples.asc
<span class="o">!</span>../external/edf2asc-linux -y -e ../data/test.edf ../data/test_events.asc
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/bin/sh: ../external/edf2asc-linux: cannot execute binary file
/bin/sh: ../external/edf2asc-linux: cannot execute binary file
</pre></div></div>
</div>
<p>This results in two files, one containing all the samples and one all the recorded events.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fname_samples</span><span class="o">=</span><span class="s2">&quot;../data/test_samples.asc&quot;</span>
<span class="n">fname_events</span><span class="o">=</span><span class="s2">&quot;../data/test_events.asc&quot;</span>
</pre></div>
</div>
</div>
<p>The samples-files contains a large table containing the timestamp, x/y-coordinates for the eyeposition and pupil-area for both the left and the right eye. Here are the first few rows of this file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>head <span class="nv">$fname_samples</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3385900   817.3   345.2  1707.0   860.6   375.2  1738.0 .....
3385902   817.0   343.5  1706.0   860.7   375.9  1739.0 .....
3385904   816.7   341.6  1705.0   861.2   376.6  1739.0 .....
3385906   816.7   340.4  1706.0   861.7   376.8  1740.0 .....
3385908   816.7   340.2  1707.0   861.6   376.9  1742.0 .....
3385910   816.8   340.2  1708.0   861.1   377.1  1743.0 .....
3385912   816.9   340.9  1708.0   860.7   377.5  1744.0 .....
3385914   816.1   342.1  1710.0   861.1   378.7  1745.0 .....
3385916   815.2   343.2  1712.0   862.5   380.0  1746.0 .....
3385918   814.4   343.6  1713.0   863.9   380.7  1747.0 .....
</pre></div></div>
</div>
<p>We can easily read this file using <code class="docutils literal notranslate"><span class="pre">pandas.read_csv()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">fname_samples</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;left_x&quot;</span><span class="p">,</span> <span class="s2">&quot;left_y&quot;</span><span class="p">,</span> <span class="s2">&quot;left_p&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;right_x&quot;</span><span class="p">,</span> <span class="s2">&quot;right_y&quot;</span><span class="p">,</span> <span class="s2">&quot;right_p&quot;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>left_x</th>
      <th>left_y</th>
      <th>left_p</th>
      <th>right_x</th>
      <th>right_y</th>
      <th>right_p</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>3385900</td>
      <td>817.3</td>
      <td>345.2</td>
      <td>1707.0</td>
      <td>860.6</td>
      <td>375.2</td>
      <td>1738.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>3385902</td>
      <td>817.0</td>
      <td>343.5</td>
      <td>1706.0</td>
      <td>860.7</td>
      <td>375.9</td>
      <td>1739.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3385904</td>
      <td>816.7</td>
      <td>341.6</td>
      <td>1705.0</td>
      <td>861.2</td>
      <td>376.6</td>
      <td>1739.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3385906</td>
      <td>816.7</td>
      <td>340.4</td>
      <td>1706.0</td>
      <td>861.7</td>
      <td>376.8</td>
      <td>1740.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>3385908</td>
      <td>816.7</td>
      <td>340.2</td>
      <td>1707.0</td>
      <td>861.6</td>
      <td>376.9</td>
      <td>1742.0</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>1245358</td>
      <td>5923060</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <td>1245359</td>
      <td>5923062</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <td>1245360</td>
      <td>5923064</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <td>1245361</td>
      <td>5923066</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <td>1245362</td>
      <td>5923068</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
      <td>.</td>
      <td>.</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>1245363 rows × 7 columns</p>
</div></div>
</div>
<p>We can already use this information to create our <code class="docutils literal notranslate"><span class="pre">PupilData</span></code>-object. We simply pass in the pupil-area of the right eye (column <code class="docutils literal notranslate"><span class="pre">right_p</span></code>) and the timestamp-array from the samples-file (Note: we could just as easily have used the left eye or the mean of both):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pp</span><span class="o">.</span><span class="n">PupilData</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">right_p</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&gt; Filling in 5 gaps
[32.35   4.012  6.21   2.02   1.862] seconds
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PupilData(test, 135.5MiB):
 n                 : 1268585
 nmiss             : 212551
 perc_miss         : 16.75496714843704
 nevents           : 0
 nblinks           : 0
 ninterpolated     : 0
 blinks_per_min    : 0.0
 fs                : 500.0
 duration_minutes  : 42.28616666666667
 start_min         : 56.431666666666665
 end_min           : 98.7178
 baseline_estimated: False
 response_estimated: False
 History:
 *
</pre></div></div>
</div>
<p>Of course, this dataset is still missing the important information contained in the event-file which we will use for analysing trial-related pupil-diameter data. For that, we will have to read the events-file, which has a more complicated structure than the samples-file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>head -20 <span class="nv">$fname_events</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
** CONVERTED FROM ../data/test.edf using edfapi 3.0 Linux Dec  1 2008 on Tue Feb 18 13:57:48 2020
** DATE: Fri Feb 14 08:48:33 2020
** TYPE: EDF_FILE BINARY EVENT SAMPLE TAGGED
** VERSION: EYELINK II 1
** SOURCE: EYELINK CL
** EYELINK II CL v6.12 Feb  1 2018 (EyeLink Portable Duo)
** CAMERA: EyeLink USBCAM Version 1.01
** SERIAL NUMBER: CLU-DAC49
** CAMERA_CONFIG: DAC49200.SCD
** Psychopy GC demo
**

MSG     2728855 DISPLAY_COORDS = 0 0 1919 1079
INPUT   2767568 0
MSG     2784000 !CAL
&gt;&gt;&gt;&gt;&gt;&gt;&gt; CALIBRATION (HV9,P-CR) FOR LEFT: &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
MSG     2784000 !CAL Calibration points:
MSG     2784000 !CAL -29.4, -23.5        -0,     -2
MSG     2784000 !CAL -29.3, -35.7        -0,  -1544
MSG     2784000 !CAL -32.9, -10.4        -0,   1559
</pre></div></div>
</div>
<p>After a header (lines starting with ‘**’) containing meta-information, we get a sequence of “events” which have different formats for all rows. We are interested in lines starting with “MSG” because those contain our experimental markers. Therefore, we read the samples file and remove all rows that do not start with “MSG” first:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># read the whole file into variable `events` (list with one entry per line)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_events</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">events</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="c1"># keep only lines starting with &quot;MSG&quot;</span>
<span class="n">events</span><span class="o">=</span><span class="p">[</span><span class="n">ev</span> <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;MSG&quot;</span><span class="p">)]</span>
<span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;MSG\t2728855 DISPLAY_COORDS = 0 0 1919 1079\n&#39;,
 &#39;MSG\t2784000 !CAL \n&#39;,
 &#39;MSG\t2784000 !CAL Calibration points:  \n&#39;,
 &#39;MSG\t2784000 !CAL -29.4, -23.5        -0,     -2   \n&#39;,
 &#39;MSG\t2784000 !CAL -29.3, -35.7        -0,  -1544   \n&#39;,
 &#39;MSG\t2784000 !CAL -32.9, -10.4        -0,   1559   \n&#39;,
 &#39;MSG\t2784000 !CAL -49.7, -23.0     -2835,     -2   \n&#39;,
 &#39;MSG\t2784000 !CAL -10.8, -27.4      2835,     -2   \n&#39;,
 &#39;MSG\t2784000 !CAL -48.3, -33.3     -2818,  -1544   \n&#39;,
 &#39;MSG\t2784000 !CAL -11.0, -34.2      2818,  -1544   \n&#39;]
</pre></div></div>
</div>
<p>Next, we added an experimental marker that was sent as the experiment was started. This marker was called <code class="docutils literal notranslate"><span class="pre">experiment_start</span></code>. Hence, we can remove all events before this marker.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">experiment_start_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">([</span><span class="s2">&quot;experiment_start&quot;</span> <span class="ow">in</span> <span class="n">ev</span> <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">events</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="n">experiment_start_index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;MSG\t3387245 C_GW_1_1_UD_UD\n&#39;,
 &#39;MSG\t3390421 F_GW_1_1_10_0\n&#39;,
 &#39;MSG\t3392759 C_NW_1_2_UD_UD\n&#39;,
 &#39;MSG\t3394293 R_NW_1_2_UD_UD\n&#39;,
 &#39;MSG\t3395952 F_NW_1_2_-1_0\n&#39;,
 &#39;MSG\t3397974 C_NA_1_3_UD_UD\n&#39;,
 &#39;MSG\t3399892 R_NA_1_3_UD_UD\n&#39;,
 &#39;MSG\t3400999 F_NA_1_3_-11_0\n&#39;,
 &#39;MSG\t3403206 C_GA_1_4_UD_UD\n&#39;,
 &#39;MSG\t3404640 R_GA_1_4_UD_UD\n&#39;]
</pre></div></div>
</div>
<p>This is in a format where we can convert it into a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object for further processing.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_ev</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">ev</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">events</span><span class="p">])</span>
<span class="n">df_ev</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>MSG</td>
      <td>3387245</td>
      <td>C_GW_1_1_UD_UD</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>1</td>
      <td>MSG</td>
      <td>3390421</td>
      <td>F_GW_1_1_10_0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>2</td>
      <td>MSG</td>
      <td>3392759</td>
      <td>C_NW_1_2_UD_UD</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>3</td>
      <td>MSG</td>
      <td>3394293</td>
      <td>R_NW_1_2_UD_UD</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>4</td>
      <td>MSG</td>
      <td>3395952</td>
      <td>F_NW_1_2_-1_0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>1065</td>
      <td>MSG</td>
      <td>5893078</td>
      <td>V_UD_UD_16_UD_UD</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>1066</td>
      <td>MSG</td>
      <td>5899076</td>
      <td>V_UD_UD_17_UD_UD</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>1067</td>
      <td>MSG</td>
      <td>5905073</td>
      <td>V_UD_UD_18_UD_UD</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>1068</td>
      <td>MSG</td>
      <td>5911072</td>
      <td>V_UD_UD_19_UD_UD</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>1069</td>
      <td>MSG</td>
      <td>5917071</td>
      <td>V_UD_UD_20_UD_UD</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>1070 rows × 9 columns</p>
</div></div>
</div>
<p>In this table, the second column contains the time-stamp (identical to the time-stamp in the samples file), and the third column contains our custom markers (the format like “C_GW_1_1_UD_UD” and so on is specific for our experimental design). There are many more columns which seem to contain no information in our samples. Let’s check what those columns are for by printing the rows in our data-frame where these columns are not <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_ev</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_ev</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">!=</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>209</td>
      <td>MSG</td>
      <td>3900393</td>
      <td>RECCFG</td>
      <td>CR</td>
      <td>500</td>
      <td>2</td>
      <td>1</td>
      <td>LR</td>
      <td>None</td>
    </tr>
    <tr>
      <td>211</td>
      <td>MSG</td>
      <td>3900393</td>
      <td>GAZE_COORDS</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>1919.00</td>
      <td>1079.00</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>212</td>
      <td>MSG</td>
      <td>3900393</td>
      <td>THRESHOLDS</td>
      <td>L</td>
      <td>56</td>
      <td>231</td>
      <td>R</td>
      <td>66</td>
      <td>239</td>
    </tr>
    <tr>
      <td>213</td>
      <td>MSG</td>
      <td>3900393</td>
      <td>ELCL_WINDOW_SIZES</td>
      <td>176</td>
      <td>188</td>
      <td>0</td>
      <td>0</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <td>215</td>
      <td>MSG</td>
      <td>3900393</td>
      <td>ELCL_PROC</td>
      <td>CENTROID</td>
      <td>(3)</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Apparently, there are more eye-tracker specific markers in our files (in this case due to drift-checks during the experiments). We can safely drop those from our set of interesting events by dropping all rows in which the fourth column is not <code class="docutils literal notranslate"><span class="pre">None</span></code> and then dropping all non-interesting columns.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_ev</span><span class="o">=</span><span class="n">df_ev</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_ev</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">==</span><span class="kc">None</span><span class="p">][[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">df_ev</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">]</span>
<span class="n">df_ev</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>event</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>3387245</td>
      <td>C_GW_1_1_UD_UD</td>
    </tr>
    <tr>
      <td>1</td>
      <td>3390421</td>
      <td>F_GW_1_1_10_0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3392759</td>
      <td>C_NW_1_2_UD_UD</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3394293</td>
      <td>R_NW_1_2_UD_UD</td>
    </tr>
    <tr>
      <td>4</td>
      <td>3395952</td>
      <td>F_NW_1_2_-1_0</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>1065</td>
      <td>5893078</td>
      <td>V_UD_UD_16_UD_UD</td>
    </tr>
    <tr>
      <td>1066</td>
      <td>5899076</td>
      <td>V_UD_UD_17_UD_UD</td>
    </tr>
    <tr>
      <td>1067</td>
      <td>5905073</td>
      <td>V_UD_UD_18_UD_UD</td>
    </tr>
    <tr>
      <td>1068</td>
      <td>5911072</td>
      <td>V_UD_UD_19_UD_UD</td>
    </tr>
    <tr>
      <td>1069</td>
      <td>5917071</td>
      <td>V_UD_UD_20_UD_UD</td>
    </tr>
  </tbody>
</table>
<p>1035 rows × 2 columns</p>
</div></div>
</div>
<p>Finally, we can pass those event-markers into our <code class="docutils literal notranslate"><span class="pre">PupilData</span></code>-object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">=</span><span class="n">pp</span><span class="o">.</span><span class="n">PupilData</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">right_p</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">event_onsets</span><span class="o">=</span><span class="n">df_ev</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">event_labels</span><span class="o">=</span><span class="n">df_ev</span><span class="o">.</span><span class="n">event</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">d</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&gt; Filling in 5 gaps
[32.35   4.012  6.21   2.02   1.862] seconds
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PupilData(test, 135.5MiB):
 n                 : 1268585
 nmiss             : 212551
 perc_miss         : 16.75496714843704
 nevents           : 1035
 nblinks           : 0
 ninterpolated     : 0
 blinks_per_min    : 0.0
 fs                : 500.0
 duration_minutes  : 42.28616666666667
 start_min         : 56.431666666666665
 end_min           : 98.7178
 baseline_estimated: False
 response_estimated: False
 History:
 *
</pre></div></div>
</div>
<p>The summary of the dataset shows us that the eyetracker started recording at time=56.4 minutes. We can reset the time index to start with 0 by using the <code class="docutils literal notranslate"><span class="pre">reset_time()</span></code> function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">reset_time</span><span class="p">()</span><span class="o">.</span><span class="n">blinks_detect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now we can store away this dataset in <code class="docutils literal notranslate"><span class="pre">pypillometry</span></code>-format and use all the <code class="docutils literal notranslate"><span class="pre">pypillometry</span></code>-functions on it, e.g., plot a minute of this dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">.</span><span class="n">sub_slice</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_original</span><span class="p">()</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="s2">&quot;../data/test.pd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span>
<span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/docs_importdata_30_0.png" src="../_images/docs_importdata_30_0.png" />
</div>
</div>
<div class="section" id="Generalize-to-multiple-similar-datasets">
<h2>Generalize to multiple similar datasets<a class="headerlink" href="#Generalize-to-multiple-similar-datasets" title="Permalink to this headline">¶</a></h2>
<p>Now that we have successfully found a way to create our <code class="docutils literal notranslate"><span class="pre">PupilData</span></code> structure from the raw <code class="docutils literal notranslate"><span class="pre">.EDF</span></code> files, we can wrap the code from this notebook into an easily accessible function that creates <code class="docutils literal notranslate"><span class="pre">PupilData</span></code> objects for a given <code class="docutils literal notranslate"><span class="pre">.EDF</span></code> file that has the same structure.</p>
<p>We simply create a function that takes the name of an <code class="docutils literal notranslate"><span class="pre">EDF</span></code>-file as input and runs all the code above, returning the final <code class="docutils literal notranslate"><span class="pre">PupilData</span></code> object. For convenience, we will assume that the <code class="docutils literal notranslate"><span class="pre">EDF2ASC</span></code> utility has already run such that <code class="docutils literal notranslate"><span class="pre">.asc</span></code> files are already available (see above for details).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">datapath</span><span class="o">=</span><span class="s2">&quot;../data&quot;</span> <span class="c1">## this is where the datafiles are located</span>

<span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="n">edffile</span><span class="p">):</span>
    <span class="n">basename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">edffile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">## remove .edf from filename</span>
    <span class="n">fname_samples</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="n">basename</span><span class="o">+</span><span class="s2">&quot;_samples.asc&quot;</span><span class="p">)</span>
    <span class="n">fname_events</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="n">basename</span><span class="o">+</span><span class="s2">&quot;_events.asc&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&gt; Attempt loading &#39;</span><span class="si">%s</span><span class="s2">&#39; and &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">fname_samples</span><span class="p">,</span> <span class="n">fname_events</span><span class="p">))</span>
    <span class="c1">## read samples-file</span>
    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">fname_samples</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;left_x&quot;</span><span class="p">,</span> <span class="s2">&quot;left_y&quot;</span><span class="p">,</span> <span class="s2">&quot;left_p&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;right_x&quot;</span><span class="p">,</span> <span class="s2">&quot;right_y&quot;</span><span class="p">,</span> <span class="s2">&quot;right_p&quot;</span><span class="p">])</span>

    <span class="c1">## read events-file</span>
    <span class="c1"># read the whole file into variable `events` (list with one entry per line)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_events</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">events</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c1"># keep only lines starting with &quot;MSG&quot;</span>
    <span class="n">events</span><span class="o">=</span><span class="p">[</span><span class="n">ev</span> <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;MSG&quot;</span><span class="p">)]</span>
    <span class="c1"># remove events before experiment start</span>
    <span class="n">experiment_start_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">([</span><span class="s2">&quot;experiment_start&quot;</span> <span class="ow">in</span> <span class="n">ev</span> <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">events</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">events</span><span class="o">=</span><span class="n">events</span><span class="p">[</span><span class="n">experiment_start_index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># re-arrange as described above</span>
    <span class="n">df_ev</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">ev</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">events</span><span class="p">])</span>
    <span class="n">df_ev</span><span class="o">=</span><span class="n">df_ev</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_ev</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">==</span><span class="kc">None</span><span class="p">][[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">df_ev</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">]</span>

    <span class="c1"># create `PupilData`-object</span>
    <span class="n">d</span><span class="o">=</span><span class="n">pp</span><span class="o">.</span><span class="n">PupilData</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">right_p</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">event_onsets</span><span class="o">=</span><span class="n">df_ev</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">event_labels</span><span class="o">=</span><span class="n">df_ev</span><span class="o">.</span><span class="n">event</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">edffile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>

</pre></div>
</div>
</div>
<p>We can test this code by simply running the function with a certain filename located in <code class="docutils literal notranslate"><span class="pre">datapath</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">read_dataset</span><span class="p">(</span><span class="s2">&quot;test.edf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&gt; Attempt loading &#39;../data/test_samples.asc&#39; and &#39;../data/test_events.asc&#39;
&gt; Filling in 5 gaps
[32.35   4.012  6.21   2.02   1.862] seconds
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PupilData(test.edf, 135.5MiB):
 n                 : 1268585
 nmiss             : 212551
 perc_miss         : 16.75496714843704
 nevents           : 1035
 nblinks           : 0
 ninterpolated     : 0
 blinks_per_min    : 0.0
 fs                : 500.0
 duration_minutes  : 42.28616666666667
 start_min         : 56.431666666666665
 end_min           : 98.7178
 baseline_estimated: False
 response_estimated: False
 History:
 *
</pre></div></div>
</div>
</div>
<div class="section" id="Storing/Loading-several-datasets">
<h2>Storing/Loading several datasets<a class="headerlink" href="#Storing/Loading-several-datasets" title="Permalink to this headline">¶</a></h2>
<p>So now it is easy to read a set of datasets into a Python <code class="docutils literal notranslate"><span class="pre">list</span></code> from the same experimental setup with a simple loop, e.g.,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">files</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;test.edf&quot;</span><span class="p">,</span> <span class="s2">&quot;test2.edf&quot;</span><span class="p">,</span> <span class="s2">&quot;test3.edf&quot;</span><span class="p">]</span>
<span class="n">datasets</span><span class="o">=</span><span class="p">[</span><span class="n">read_dataset</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&gt; Attempt loading &#39;../data/test_samples.asc&#39; and &#39;../data/test_events.asc&#39;
&gt; Filling in 5 gaps
[32.35   4.012  6.21   2.02   1.862] seconds
</pre></div></div>
</div>
<p>After that, we might want to save the final <code class="docutils literal notranslate"><span class="pre">PupilData</span></code> objects as <code class="docutils literal notranslate"><span class="pre">.pd</span></code> files that can be readily loaded back. Here, we loop through the list of datasets and store each of them in separate files using the <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute of the object as filename.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
    <span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.pd&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>These datasets can be read back using the <code class="docutils literal notranslate"><span class="pre">PupilData.from_file()</span></code> method:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># all filenames in `datapath` that end with `.pd`</span>
<span class="n">pd_files</span><span class="o">=</span><span class="p">[</span><span class="n">fname</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">datapath</span><span class="p">)</span> <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pd&quot;</span><span class="p">)]</span>
<span class="n">datasets</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">pd_files</span><span class="p">:</span>
    <span class="n">fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">d</span><span class="o">=</span><span class="n">pp</span><span class="o">.</span><span class="n">PupilData</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>It is also possible to store the whole <code class="docutils literal notranslate"><span class="pre">list</span></code> as a single file by using the <code class="docutils literal notranslate"><span class="pre">pd_write_pickle()</span></code>-function:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pp</span><span class="o">.</span><span class="n">pd_write_pickle</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;full_dataset.pd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>which can be read-back using the <code class="docutils literal notranslate"><span class="pre">pd_read_pickle()</span></code> function like so:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">datasets</span><span class="o">=</span><span class="n">pp</span><span class="o">.</span><span class="n">pd_read_pickle</span><span class="p">(</span><span class="s2">&quot;full_dataset.pd&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/pypillometry_logo_200x200.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Importing Data Example</a><ul>
<li><a class="reference internal" href="#Generalize-to-multiple-similar-datasets">Generalize to multiple similar datasets</a></li>
<li><a class="reference internal" href="#Storing/Loading-several-datasets">Storing/Loading several datasets</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dev.html"
                        title="previous chapter">Developers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="blinks.html"
                        title="next chapter">Blink preprocessing</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docs/importdata.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="blinks.html" title="Blink preprocessing"
             >next</a> |</li>
        <li class="right" >
          <a href="dev.html" title="Developers"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pypillometry  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Matthias Mittner.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>